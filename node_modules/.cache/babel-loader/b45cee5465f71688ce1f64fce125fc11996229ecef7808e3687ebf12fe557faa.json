{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decompress = exports.compress = exports.uncompressibleCommands = exports.Compressor = void 0;\nconst zlib = require(\"zlib\");\nconst deps_1 = require(\"../../deps\");\nconst error_1 = require(\"../../error\");\n/** @public */\nexports.Compressor = Object.freeze({\n  none: 0,\n  snappy: 1,\n  zlib: 2\n});\nexports.uncompressibleCommands = new Set(['ismaster', 'saslStart', 'saslContinue', 'getnonce', 'authenticate', 'createUser', 'updateUser', 'copydbSaslStart', 'copydbgetnonce', 'copydb']);\n// Facilitate compressing a message using an agreed compressor\nfunction compress(self, dataToBeCompressed, callback) {\n  const zlibOptions = {};\n  switch (self.options.agreedCompressor) {\n    case 'snappy':\n      if ('kModuleError' in deps_1.Snappy) {\n        return callback(deps_1.Snappy['kModuleError']);\n      }\n      deps_1.Snappy.compress(dataToBeCompressed, callback);\n      break;\n    case 'zlib':\n      // Determine zlibCompressionLevel\n      if (self.options.zlibCompressionLevel) {\n        zlibOptions.level = self.options.zlibCompressionLevel;\n      }\n      zlib.deflate(dataToBeCompressed, zlibOptions, callback);\n      break;\n    default:\n      throw new error_1.MongoDriverError('Attempt to compress message using unknown compressor \"' + self.options.agreedCompressor + '\".');\n  }\n}\nexports.compress = compress;\n// Decompress a message using the given compressor\nfunction decompress(compressorID, compressedData, callback) {\n  if (compressorID < 0 || compressorID > Math.max(2)) {\n    throw new error_1.MongoDriverError(`Server sent message compressed using an unsupported compressor.` + ` (Received compressor ID ${compressorID})`);\n  }\n  switch (compressorID) {\n    case exports.Compressor.snappy:\n      if ('kModuleError' in deps_1.Snappy) {\n        return callback(deps_1.Snappy['kModuleError']);\n      }\n      deps_1.Snappy.uncompress(compressedData, {\n        asBuffer: true\n      }, callback);\n      break;\n    case exports.Compressor.zlib:\n      zlib.inflate(compressedData, callback);\n      break;\n    default:\n      callback(undefined, compressedData);\n  }\n}\nexports.decompress = decompress;","map":{"version":3,"names":["zlib","require","deps_1","error_1","exports","Compressor","Object","freeze","none","snappy","uncompressibleCommands","Set","compress","self","dataToBeCompressed","callback","zlibOptions","options","agreedCompressor","Snappy","zlibCompressionLevel","level","deflate","MongoDriverError","decompress","compressorID","compressedData","Math","max","uncompress","asBuffer","inflate","undefined"],"sources":["C:\\Users\\pranav kamat\\node_modules\\mongodb\\src\\cmap\\wire_protocol\\compression.ts"],"sourcesContent":["import * as zlib from 'zlib';\nimport type { Callback } from '../../utils';\nimport type { OperationDescription } from '../message_stream';\n\nimport { Snappy } from '../../deps';\nimport { MongoDriverError } from '../../error';\n\n/** @public */\nexport const Compressor = Object.freeze({\n  none: 0,\n  snappy: 1,\n  zlib: 2\n} as const);\n\n/** @public */\nexport type Compressor = typeof Compressor[CompressorName];\n\n/** @public */\nexport type CompressorName = keyof typeof Compressor;\n\nexport const uncompressibleCommands = new Set([\n  'ismaster',\n  'saslStart',\n  'saslContinue',\n  'getnonce',\n  'authenticate',\n  'createUser',\n  'updateUser',\n  'copydbSaslStart',\n  'copydbgetnonce',\n  'copydb'\n]);\n\n// Facilitate compressing a message using an agreed compressor\nexport function compress(\n  self: { options: OperationDescription & zlib.ZlibOptions },\n  dataToBeCompressed: Buffer,\n  callback: Callback<Buffer>\n): void {\n  const zlibOptions = {} as zlib.ZlibOptions;\n  switch (self.options.agreedCompressor) {\n    case 'snappy':\n      if ('kModuleError' in Snappy) {\n        return callback(Snappy['kModuleError']);\n      }\n      Snappy.compress(dataToBeCompressed, callback);\n      break;\n    case 'zlib':\n      // Determine zlibCompressionLevel\n      if (self.options.zlibCompressionLevel) {\n        zlibOptions.level = self.options.zlibCompressionLevel;\n      }\n      zlib.deflate(dataToBeCompressed, zlibOptions, callback as zlib.CompressCallback);\n      break;\n    default:\n      throw new MongoDriverError(\n        'Attempt to compress message using unknown compressor \"' +\n          self.options.agreedCompressor +\n          '\".'\n      );\n  }\n}\n\n// Decompress a message using the given compressor\nexport function decompress(\n  compressorID: Compressor,\n  compressedData: Buffer,\n  callback: Callback<Buffer>\n): void {\n  if (compressorID < 0 || compressorID > Math.max(2)) {\n    throw new MongoDriverError(\n      `Server sent message compressed using an unsupported compressor.` +\n        ` (Received compressor ID ${compressorID})`\n    );\n  }\n\n  switch (compressorID) {\n    case Compressor.snappy:\n      if ('kModuleError' in Snappy) {\n        return callback(Snappy['kModuleError']);\n      }\n      Snappy.uncompress(compressedData, { asBuffer: true }, callback as Callback);\n      break;\n    case Compressor.zlib:\n      zlib.inflate(compressedData, callback as zlib.CompressCallback);\n      break;\n    default:\n      callback(undefined, compressedData);\n  }\n}\n"],"mappings":";;;;;;AAAA,MAAAA,IAAA,GAAAC,OAAA;AAIA,MAAAC,MAAA,GAAAD,OAAA;AACA,MAAAE,OAAA,GAAAF,OAAA;AAEA;AACaG,OAAA,CAAAC,UAAU,GAAGC,MAAM,CAACC,MAAM,CAAC;EACtCC,IAAI,EAAE,CAAC;EACPC,MAAM,EAAE,CAAC;EACTT,IAAI,EAAE;CACE,CAAC;AAQEI,OAAA,CAAAM,sBAAsB,GAAG,IAAIC,GAAG,CAAC,CAC5C,UAAU,EACV,WAAW,EACX,cAAc,EACd,UAAU,EACV,cAAc,EACd,YAAY,EACZ,YAAY,EACZ,iBAAiB,EACjB,gBAAgB,EAChB,QAAQ,CACT,CAAC;AAEF;AACA,SAAgBC,QAAQA,CACtBC,IAA0D,EAC1DC,kBAA0B,EAC1BC,QAA0B;EAE1B,MAAMC,WAAW,GAAG,EAAsB;EAC1C,QAAQH,IAAI,CAACI,OAAO,CAACC,gBAAgB;IACnC,KAAK,QAAQ;MACX,IAAI,cAAc,IAAIhB,MAAA,CAAAiB,MAAM,EAAE;QAC5B,OAAOJ,QAAQ,CAACb,MAAA,CAAAiB,MAAM,CAAC,cAAc,CAAC,CAAC;;MAEzCjB,MAAA,CAAAiB,MAAM,CAACP,QAAQ,CAACE,kBAAkB,EAAEC,QAAQ,CAAC;MAC7C;IACF,KAAK,MAAM;MACT;MACA,IAAIF,IAAI,CAACI,OAAO,CAACG,oBAAoB,EAAE;QACrCJ,WAAW,CAACK,KAAK,GAAGR,IAAI,CAACI,OAAO,CAACG,oBAAoB;;MAEvDpB,IAAI,CAACsB,OAAO,CAACR,kBAAkB,EAAEE,WAAW,EAAED,QAAiC,CAAC;MAChF;IACF;MACE,MAAM,IAAIZ,OAAA,CAAAoB,gBAAgB,CACxB,wDAAwD,GACtDV,IAAI,CAACI,OAAO,CAACC,gBAAgB,GAC7B,IAAI,CACP;;AAEP;AA3BAd,OAAA,CAAAQ,QAAA,GAAAA,QAAA;AA6BA;AACA,SAAgBY,UAAUA,CACxBC,YAAwB,EACxBC,cAAsB,EACtBX,QAA0B;EAE1B,IAAIU,YAAY,GAAG,CAAC,IAAIA,YAAY,GAAGE,IAAI,CAACC,GAAG,CAAC,CAAC,CAAC,EAAE;IAClD,MAAM,IAAIzB,OAAA,CAAAoB,gBAAgB,CACxB,iEAAiE,GAC/D,4BAA4BE,YAAY,GAAG,CAC9C;;EAGH,QAAQA,YAAY;IAClB,KAAKrB,OAAA,CAAAC,UAAU,CAACI,MAAM;MACpB,IAAI,cAAc,IAAIP,MAAA,CAAAiB,MAAM,EAAE;QAC5B,OAAOJ,QAAQ,CAACb,MAAA,CAAAiB,MAAM,CAAC,cAAc,CAAC,CAAC;;MAEzCjB,MAAA,CAAAiB,MAAM,CAACU,UAAU,CAACH,cAAc,EAAE;QAAEI,QAAQ,EAAE;MAAI,CAAE,EAAEf,QAAoB,CAAC;MAC3E;IACF,KAAKX,OAAA,CAAAC,UAAU,CAACL,IAAI;MAClBA,IAAI,CAAC+B,OAAO,CAACL,cAAc,EAAEX,QAAiC,CAAC;MAC/D;IACF;MACEA,QAAQ,CAACiB,SAAS,EAAEN,cAAc,CAAC;;AAEzC;AAzBAtB,OAAA,CAAAoB,UAAA,GAAAA,UAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}