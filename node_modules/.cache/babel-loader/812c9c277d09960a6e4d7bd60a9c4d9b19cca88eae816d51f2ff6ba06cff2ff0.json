{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BinMsg = exports.Msg = exports.Response = exports.KillCursor = exports.GetMore = exports.Query = void 0;\nconst read_preference_1 = require(\"../read_preference\");\nconst BSON = require(\"../bson\");\nconst utils_1 = require(\"../utils\");\nconst constants_1 = require(\"./wire_protocol/constants\");\nconst error_1 = require(\"../error\");\n// Incrementing request id\nlet _requestId = 0;\n// Query flags\nconst OPTS_TAILABLE_CURSOR = 2;\nconst OPTS_SLAVE = 4;\nconst OPTS_OPLOG_REPLAY = 8;\nconst OPTS_NO_CURSOR_TIMEOUT = 16;\nconst OPTS_AWAIT_DATA = 32;\nconst OPTS_EXHAUST = 64;\nconst OPTS_PARTIAL = 128;\n// Response flags\nconst CURSOR_NOT_FOUND = 1;\nconst QUERY_FAILURE = 2;\nconst SHARD_CONFIG_STALE = 4;\nconst AWAIT_CAPABLE = 8;\n/**************************************************************\n * QUERY\n **************************************************************/\n/** @internal */\nclass Query {\n  constructor(ns, query, options) {\n    // Basic options needed to be passed in\n    if (ns == null) throw new error_1.MongoDriverError('ns must be specified for query');\n    if (query == null) throw new error_1.MongoDriverError('query must be specified for query');\n    // Validate that we are not passing 0x00 in the collection name\n    if (ns.indexOf('\\x00') !== -1) {\n      throw new error_1.MongoDriverError('namespace cannot contain a null character');\n    }\n    // Basic options\n    this.ns = ns;\n    this.query = query;\n    // Additional options\n    this.numberToSkip = options.numberToSkip || 0;\n    this.numberToReturn = options.numberToReturn || 0;\n    this.returnFieldSelector = options.returnFieldSelector || undefined;\n    this.requestId = Query.getRequestId();\n    // special case for pre-3.2 find commands, delete ASAP\n    this.pre32Limit = options.pre32Limit;\n    // Serialization option\n    this.serializeFunctions = typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n    this.ignoreUndefined = typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n    this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n    this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n    this.batchSize = this.numberToReturn;\n    // Flags\n    this.tailable = false;\n    this.slaveOk = typeof options.slaveOk === 'boolean' ? options.slaveOk : false;\n    this.oplogReplay = false;\n    this.noCursorTimeout = false;\n    this.awaitData = false;\n    this.exhaust = false;\n    this.partial = false;\n  }\n  /** Assign next request Id. */\n  incRequestId() {\n    this.requestId = _requestId++;\n  }\n  /** Peek next request Id. */\n  nextRequestId() {\n    return _requestId + 1;\n  }\n  /** Increment then return next request Id. */\n  static getRequestId() {\n    return ++_requestId;\n  }\n  // Uses a single allocated buffer for the process, avoiding multiple memory allocations\n  toBin() {\n    const buffers = [];\n    let projection = null;\n    // Set up the flags\n    let flags = 0;\n    if (this.tailable) {\n      flags |= OPTS_TAILABLE_CURSOR;\n    }\n    if (this.slaveOk) {\n      flags |= OPTS_SLAVE;\n    }\n    if (this.oplogReplay) {\n      flags |= OPTS_OPLOG_REPLAY;\n    }\n    if (this.noCursorTimeout) {\n      flags |= OPTS_NO_CURSOR_TIMEOUT;\n    }\n    if (this.awaitData) {\n      flags |= OPTS_AWAIT_DATA;\n    }\n    if (this.exhaust) {\n      flags |= OPTS_EXHAUST;\n    }\n    if (this.partial) {\n      flags |= OPTS_PARTIAL;\n    }\n    // If batchSize is different to this.numberToReturn\n    if (this.batchSize !== this.numberToReturn) this.numberToReturn = this.batchSize;\n    // Allocate write protocol header buffer\n    const header = Buffer.alloc(4 * 4 +\n    // Header\n    4 +\n    // Flags\n    Buffer.byteLength(this.ns) + 1 +\n    // namespace\n    4 +\n    // numberToSkip\n    4 // numberToReturn\n    );\n    // Add header to buffers\n    buffers.push(header);\n    // Serialize the query\n    const query = BSON.serialize(this.query, {\n      checkKeys: this.checkKeys,\n      serializeFunctions: this.serializeFunctions,\n      ignoreUndefined: this.ignoreUndefined\n    });\n    // Add query document\n    buffers.push(query);\n    if (this.returnFieldSelector && Object.keys(this.returnFieldSelector).length > 0) {\n      // Serialize the projection document\n      projection = BSON.serialize(this.returnFieldSelector, {\n        checkKeys: this.checkKeys,\n        serializeFunctions: this.serializeFunctions,\n        ignoreUndefined: this.ignoreUndefined\n      });\n      // Add projection document\n      buffers.push(projection);\n    }\n    // Total message size\n    const totalLength = header.length + query.length + (projection ? projection.length : 0);\n    // Set up the index\n    let index = 4;\n    // Write total document length\n    header[3] = totalLength >> 24 & 0xff;\n    header[2] = totalLength >> 16 & 0xff;\n    header[1] = totalLength >> 8 & 0xff;\n    header[0] = totalLength & 0xff;\n    // Write header information requestId\n    header[index + 3] = this.requestId >> 24 & 0xff;\n    header[index + 2] = this.requestId >> 16 & 0xff;\n    header[index + 1] = this.requestId >> 8 & 0xff;\n    header[index] = this.requestId & 0xff;\n    index = index + 4;\n    // Write header information responseTo\n    header[index + 3] = 0 >> 24 & 0xff;\n    header[index + 2] = 0 >> 16 & 0xff;\n    header[index + 1] = 0 >> 8 & 0xff;\n    header[index] = 0 & 0xff;\n    index = index + 4;\n    // Write header information OP_QUERY\n    header[index + 3] = constants_1.OP_QUERY >> 24 & 0xff;\n    header[index + 2] = constants_1.OP_QUERY >> 16 & 0xff;\n    header[index + 1] = constants_1.OP_QUERY >> 8 & 0xff;\n    header[index] = constants_1.OP_QUERY & 0xff;\n    index = index + 4;\n    // Write header information flags\n    header[index + 3] = flags >> 24 & 0xff;\n    header[index + 2] = flags >> 16 & 0xff;\n    header[index + 1] = flags >> 8 & 0xff;\n    header[index] = flags & 0xff;\n    index = index + 4;\n    // Write collection name\n    index = index + header.write(this.ns, index, 'utf8') + 1;\n    header[index - 1] = 0;\n    // Write header information flags numberToSkip\n    header[index + 3] = this.numberToSkip >> 24 & 0xff;\n    header[index + 2] = this.numberToSkip >> 16 & 0xff;\n    header[index + 1] = this.numberToSkip >> 8 & 0xff;\n    header[index] = this.numberToSkip & 0xff;\n    index = index + 4;\n    // Write header information flags numberToReturn\n    header[index + 3] = this.numberToReturn >> 24 & 0xff;\n    header[index + 2] = this.numberToReturn >> 16 & 0xff;\n    header[index + 1] = this.numberToReturn >> 8 & 0xff;\n    header[index] = this.numberToReturn & 0xff;\n    index = index + 4;\n    // Return the buffers\n    return buffers;\n  }\n}\nexports.Query = Query;\n/**************************************************************\n * GETMORE\n **************************************************************/\n/** @internal */\nclass GetMore {\n  constructor(ns, cursorId, opts = {}) {\n    this.numberToReturn = opts.numberToReturn || 0;\n    this.requestId = _requestId++;\n    this.ns = ns;\n    this.cursorId = cursorId;\n  }\n  // Uses a single allocated buffer for the process, avoiding multiple memory allocations\n  toBin() {\n    const length = 4 + Buffer.byteLength(this.ns) + 1 + 4 + 8 + 4 * 4;\n    // Create command buffer\n    let index = 0;\n    // Allocate buffer\n    const _buffer = Buffer.alloc(length);\n    // Write header information\n    // index = write32bit(index, _buffer, length);\n    _buffer[index + 3] = length >> 24 & 0xff;\n    _buffer[index + 2] = length >> 16 & 0xff;\n    _buffer[index + 1] = length >> 8 & 0xff;\n    _buffer[index] = length & 0xff;\n    index = index + 4;\n    // index = write32bit(index, _buffer, requestId);\n    _buffer[index + 3] = this.requestId >> 24 & 0xff;\n    _buffer[index + 2] = this.requestId >> 16 & 0xff;\n    _buffer[index + 1] = this.requestId >> 8 & 0xff;\n    _buffer[index] = this.requestId & 0xff;\n    index = index + 4;\n    // index = write32bit(index, _buffer, 0);\n    _buffer[index + 3] = 0 >> 24 & 0xff;\n    _buffer[index + 2] = 0 >> 16 & 0xff;\n    _buffer[index + 1] = 0 >> 8 & 0xff;\n    _buffer[index] = 0 & 0xff;\n    index = index + 4;\n    // index = write32bit(index, _buffer, OP_GETMORE);\n    _buffer[index + 3] = constants_1.OP_GETMORE >> 24 & 0xff;\n    _buffer[index + 2] = constants_1.OP_GETMORE >> 16 & 0xff;\n    _buffer[index + 1] = constants_1.OP_GETMORE >> 8 & 0xff;\n    _buffer[index] = constants_1.OP_GETMORE & 0xff;\n    index = index + 4;\n    // index = write32bit(index, _buffer, 0);\n    _buffer[index + 3] = 0 >> 24 & 0xff;\n    _buffer[index + 2] = 0 >> 16 & 0xff;\n    _buffer[index + 1] = 0 >> 8 & 0xff;\n    _buffer[index] = 0 & 0xff;\n    index = index + 4;\n    // Write collection name\n    index = index + _buffer.write(this.ns, index, 'utf8') + 1;\n    _buffer[index - 1] = 0;\n    // Write batch size\n    // index = write32bit(index, _buffer, numberToReturn);\n    _buffer[index + 3] = this.numberToReturn >> 24 & 0xff;\n    _buffer[index + 2] = this.numberToReturn >> 16 & 0xff;\n    _buffer[index + 1] = this.numberToReturn >> 8 & 0xff;\n    _buffer[index] = this.numberToReturn & 0xff;\n    index = index + 4;\n    // Write cursor id\n    // index = write32bit(index, _buffer, cursorId.getLowBits());\n    _buffer[index + 3] = this.cursorId.getLowBits() >> 24 & 0xff;\n    _buffer[index + 2] = this.cursorId.getLowBits() >> 16 & 0xff;\n    _buffer[index + 1] = this.cursorId.getLowBits() >> 8 & 0xff;\n    _buffer[index] = this.cursorId.getLowBits() & 0xff;\n    index = index + 4;\n    // index = write32bit(index, _buffer, cursorId.getHighBits());\n    _buffer[index + 3] = this.cursorId.getHighBits() >> 24 & 0xff;\n    _buffer[index + 2] = this.cursorId.getHighBits() >> 16 & 0xff;\n    _buffer[index + 1] = this.cursorId.getHighBits() >> 8 & 0xff;\n    _buffer[index] = this.cursorId.getHighBits() & 0xff;\n    index = index + 4;\n    // Return buffer\n    return [_buffer];\n  }\n}\nexports.GetMore = GetMore;\n/**************************************************************\n * KILLCURSOR\n **************************************************************/\n/** @internal */\nclass KillCursor {\n  constructor(ns, cursorIds) {\n    this.ns = ns;\n    this.requestId = _requestId++;\n    this.cursorIds = cursorIds;\n  }\n  // Uses a single allocated buffer for the process, avoiding multiple memory allocations\n  toBin() {\n    const length = 4 + 4 + 4 * 4 + this.cursorIds.length * 8;\n    // Create command buffer\n    let index = 0;\n    const _buffer = Buffer.alloc(length);\n    // Write header information\n    // index = write32bit(index, _buffer, length);\n    _buffer[index + 3] = length >> 24 & 0xff;\n    _buffer[index + 2] = length >> 16 & 0xff;\n    _buffer[index + 1] = length >> 8 & 0xff;\n    _buffer[index] = length & 0xff;\n    index = index + 4;\n    // index = write32bit(index, _buffer, requestId);\n    _buffer[index + 3] = this.requestId >> 24 & 0xff;\n    _buffer[index + 2] = this.requestId >> 16 & 0xff;\n    _buffer[index + 1] = this.requestId >> 8 & 0xff;\n    _buffer[index] = this.requestId & 0xff;\n    index = index + 4;\n    // index = write32bit(index, _buffer, 0);\n    _buffer[index + 3] = 0 >> 24 & 0xff;\n    _buffer[index + 2] = 0 >> 16 & 0xff;\n    _buffer[index + 1] = 0 >> 8 & 0xff;\n    _buffer[index] = 0 & 0xff;\n    index = index + 4;\n    // index = write32bit(index, _buffer, OP_KILL_CURSORS);\n    _buffer[index + 3] = constants_1.OP_KILL_CURSORS >> 24 & 0xff;\n    _buffer[index + 2] = constants_1.OP_KILL_CURSORS >> 16 & 0xff;\n    _buffer[index + 1] = constants_1.OP_KILL_CURSORS >> 8 & 0xff;\n    _buffer[index] = constants_1.OP_KILL_CURSORS & 0xff;\n    index = index + 4;\n    // index = write32bit(index, _buffer, 0);\n    _buffer[index + 3] = 0 >> 24 & 0xff;\n    _buffer[index + 2] = 0 >> 16 & 0xff;\n    _buffer[index + 1] = 0 >> 8 & 0xff;\n    _buffer[index] = 0 & 0xff;\n    index = index + 4;\n    // Write batch size\n    // index = write32bit(index, _buffer, this.cursorIds.length);\n    _buffer[index + 3] = this.cursorIds.length >> 24 & 0xff;\n    _buffer[index + 2] = this.cursorIds.length >> 16 & 0xff;\n    _buffer[index + 1] = this.cursorIds.length >> 8 & 0xff;\n    _buffer[index] = this.cursorIds.length & 0xff;\n    index = index + 4;\n    // Write all the cursor ids into the array\n    for (let i = 0; i < this.cursorIds.length; i++) {\n      // Write cursor id\n      // index = write32bit(index, _buffer, cursorIds[i].getLowBits());\n      _buffer[index + 3] = this.cursorIds[i].getLowBits() >> 24 & 0xff;\n      _buffer[index + 2] = this.cursorIds[i].getLowBits() >> 16 & 0xff;\n      _buffer[index + 1] = this.cursorIds[i].getLowBits() >> 8 & 0xff;\n      _buffer[index] = this.cursorIds[i].getLowBits() & 0xff;\n      index = index + 4;\n      // index = write32bit(index, _buffer, cursorIds[i].getHighBits());\n      _buffer[index + 3] = this.cursorIds[i].getHighBits() >> 24 & 0xff;\n      _buffer[index + 2] = this.cursorIds[i].getHighBits() >> 16 & 0xff;\n      _buffer[index + 1] = this.cursorIds[i].getHighBits() >> 8 & 0xff;\n      _buffer[index] = this.cursorIds[i].getHighBits() & 0xff;\n      index = index + 4;\n    }\n    // Return buffer\n    return [_buffer];\n  }\n}\nexports.KillCursor = KillCursor;\n/** @internal */\nclass Response {\n  constructor(message, msgHeader, msgBody, opts) {\n    this.parsed = false;\n    this.raw = message;\n    this.data = msgBody;\n    this.opts = opts !== null && opts !== void 0 ? opts : {\n      promoteLongs: true,\n      promoteValues: true,\n      promoteBuffers: false,\n      bsonRegExp: false\n    };\n    // Read the message header\n    this.length = msgHeader.length;\n    this.requestId = msgHeader.requestId;\n    this.responseTo = msgHeader.responseTo;\n    this.opCode = msgHeader.opCode;\n    this.fromCompressed = msgHeader.fromCompressed;\n    // Read the message body\n    this.responseFlags = msgBody.readInt32LE(0);\n    this.cursorId = new BSON.Long(msgBody.readInt32LE(4), msgBody.readInt32LE(8));\n    this.startingFrom = msgBody.readInt32LE(12);\n    this.numberReturned = msgBody.readInt32LE(16);\n    // Preallocate document array\n    this.documents = new Array(this.numberReturned);\n    // Flag values\n    this.cursorNotFound = (this.responseFlags & CURSOR_NOT_FOUND) !== 0;\n    this.queryFailure = (this.responseFlags & QUERY_FAILURE) !== 0;\n    this.shardConfigStale = (this.responseFlags & SHARD_CONFIG_STALE) !== 0;\n    this.awaitCapable = (this.responseFlags & AWAIT_CAPABLE) !== 0;\n    this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n    this.promoteValues = typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n    this.promoteBuffers = typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n    this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n  }\n  isParsed() {\n    return this.parsed;\n  }\n  parse(options) {\n    var _a, _b, _c, _d;\n    // Don't parse again if not needed\n    if (this.parsed) return;\n    options = options !== null && options !== void 0 ? options : {};\n    // Allow the return of raw documents instead of parsing\n    const raw = options.raw || false;\n    const documentsReturnedIn = options.documentsReturnedIn || null;\n    const promoteLongs = (_a = options.promoteLongs) !== null && _a !== void 0 ? _a : this.opts.promoteLongs;\n    const promoteValues = (_b = options.promoteValues) !== null && _b !== void 0 ? _b : this.opts.promoteValues;\n    const promoteBuffers = (_c = options.promoteBuffers) !== null && _c !== void 0 ? _c : this.opts.promoteBuffers;\n    const bsonRegExp = (_d = options.bsonRegExp) !== null && _d !== void 0 ? _d : this.opts.bsonRegExp;\n    let bsonSize;\n    // Set up the options\n    const _options = {\n      promoteLongs,\n      promoteValues,\n      promoteBuffers,\n      bsonRegExp\n    };\n    // Position within OP_REPLY at which documents start\n    // (See https://docs.mongodb.com/manual/reference/mongodb-wire-protocol/#wire-op-reply)\n    this.index = 20;\n    // Parse Body\n    for (let i = 0; i < this.numberReturned; i++) {\n      bsonSize = this.data[this.index] | this.data[this.index + 1] << 8 | this.data[this.index + 2] << 16 | this.data[this.index + 3] << 24;\n      // If we have raw results specified slice the return document\n      if (raw) {\n        this.documents[i] = this.data.slice(this.index, this.index + bsonSize);\n      } else {\n        this.documents[i] = BSON.deserialize(this.data.slice(this.index, this.index + bsonSize), _options);\n      }\n      // Adjust the index\n      this.index = this.index + bsonSize;\n    }\n    if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\n      const fieldsAsRaw = {};\n      fieldsAsRaw[documentsReturnedIn] = true;\n      _options.fieldsAsRaw = fieldsAsRaw;\n      const doc = BSON.deserialize(this.documents[0], _options);\n      this.documents = [doc];\n    }\n    // Set parsed\n    this.parsed = true;\n  }\n}\nexports.Response = Response;\n// Implementation of OP_MSG spec:\n// https://github.com/mongodb/specifications/blob/master/source/message/OP_MSG.rst\n//\n// struct Section {\n//   uint8 payloadType;\n//   union payload {\n//       document  document; // payloadType == 0\n//       struct sequence { // payloadType == 1\n//           int32      size;\n//           cstring    identifier;\n//           document*  documents;\n//       };\n//   };\n// };\n// struct OP_MSG {\n//   struct MsgHeader {\n//       int32  messageLength;\n//       int32  requestID;\n//       int32  responseTo;\n//       int32  opCode = 2013;\n//   };\n//   uint32      flagBits;\n//   Section+    sections;\n//   [uint32     checksum;]\n// };\n// Msg Flags\nconst OPTS_CHECKSUM_PRESENT = 1;\nconst OPTS_MORE_TO_COME = 2;\nconst OPTS_EXHAUST_ALLOWED = 1 << 16;\n/** @internal */\nclass Msg {\n  constructor(ns, command, options) {\n    // Basic options needed to be passed in\n    if (command == null) throw new error_1.MongoDriverError('query must be specified for query');\n    // Basic options\n    this.ns = ns;\n    this.command = command;\n    this.command.$db = utils_1.databaseNamespace(ns);\n    if (options.readPreference && options.readPreference.mode !== read_preference_1.ReadPreference.PRIMARY) {\n      this.command.$readPreference = options.readPreference.toJSON();\n    }\n    // Ensure empty options\n    this.options = options !== null && options !== void 0 ? options : {};\n    // Additional options\n    this.requestId = options.requestId ? options.requestId : Msg.getRequestId();\n    // Serialization option\n    this.serializeFunctions = typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n    this.ignoreUndefined = typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n    this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n    this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n    // flags\n    this.checksumPresent = false;\n    this.moreToCome = options.moreToCome || false;\n    this.exhaustAllowed = typeof options.exhaustAllowed === 'boolean' ? options.exhaustAllowed : false;\n  }\n  toBin() {\n    const buffers = [];\n    let flags = 0;\n    if (this.checksumPresent) {\n      flags |= OPTS_CHECKSUM_PRESENT;\n    }\n    if (this.moreToCome) {\n      flags |= OPTS_MORE_TO_COME;\n    }\n    if (this.exhaustAllowed) {\n      flags |= OPTS_EXHAUST_ALLOWED;\n    }\n    const header = Buffer.alloc(4 * 4 +\n    // Header\n    4 // Flags\n    );\n\n    buffers.push(header);\n    let totalLength = header.length;\n    const command = this.command;\n    totalLength += this.makeDocumentSegment(buffers, command);\n    header.writeInt32LE(totalLength, 0); // messageLength\n    header.writeInt32LE(this.requestId, 4); // requestID\n    header.writeInt32LE(0, 8); // responseTo\n    header.writeInt32LE(constants_1.OP_MSG, 12); // opCode\n    header.writeUInt32LE(flags, 16); // flags\n    return buffers;\n  }\n  makeDocumentSegment(buffers, document) {\n    const payloadTypeBuffer = Buffer.alloc(1);\n    payloadTypeBuffer[0] = 0;\n    const documentBuffer = this.serializeBson(document);\n    buffers.push(payloadTypeBuffer);\n    buffers.push(documentBuffer);\n    return payloadTypeBuffer.length + documentBuffer.length;\n  }\n  serializeBson(document) {\n    return BSON.serialize(document, {\n      checkKeys: this.checkKeys,\n      serializeFunctions: this.serializeFunctions,\n      ignoreUndefined: this.ignoreUndefined\n    });\n  }\n  static getRequestId() {\n    _requestId = _requestId + 1 & 0x7fffffff;\n    return _requestId;\n  }\n}\nexports.Msg = Msg;\n/** @internal */\nclass BinMsg {\n  constructor(message, msgHeader, msgBody, opts) {\n    this.parsed = false;\n    this.raw = message;\n    this.data = msgBody;\n    this.opts = opts !== null && opts !== void 0 ? opts : {\n      promoteLongs: true,\n      promoteValues: true,\n      promoteBuffers: false,\n      bsonRegExp: false\n    };\n    // Read the message header\n    this.length = msgHeader.length;\n    this.requestId = msgHeader.requestId;\n    this.responseTo = msgHeader.responseTo;\n    this.opCode = msgHeader.opCode;\n    this.fromCompressed = msgHeader.fromCompressed;\n    // Read response flags\n    this.responseFlags = msgBody.readInt32LE(0);\n    this.checksumPresent = (this.responseFlags & OPTS_CHECKSUM_PRESENT) !== 0;\n    this.moreToCome = (this.responseFlags & OPTS_MORE_TO_COME) !== 0;\n    this.exhaustAllowed = (this.responseFlags & OPTS_EXHAUST_ALLOWED) !== 0;\n    this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n    this.promoteValues = typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n    this.promoteBuffers = typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n    this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n    this.documents = [];\n  }\n  isParsed() {\n    return this.parsed;\n  }\n  parse(options) {\n    var _a, _b, _c, _d;\n    // Don't parse again if not needed\n    if (this.parsed) return;\n    options = options !== null && options !== void 0 ? options : {};\n    this.index = 4;\n    // Allow the return of raw documents instead of parsing\n    const raw = options.raw || false;\n    const documentsReturnedIn = options.documentsReturnedIn || null;\n    const promoteLongs = (_a = options.promoteLongs) !== null && _a !== void 0 ? _a : this.opts.promoteLongs;\n    const promoteValues = (_b = options.promoteValues) !== null && _b !== void 0 ? _b : this.opts.promoteValues;\n    const promoteBuffers = (_c = options.promoteBuffers) !== null && _c !== void 0 ? _c : this.opts.promoteBuffers;\n    const bsonRegExp = (_d = options.bsonRegExp) !== null && _d !== void 0 ? _d : this.opts.bsonRegExp;\n    // Set up the options\n    const _options = {\n      promoteLongs,\n      promoteValues,\n      promoteBuffers,\n      bsonRegExp\n    };\n    while (this.index < this.data.length) {\n      const payloadType = this.data.readUInt8(this.index++);\n      if (payloadType === 0) {\n        const bsonSize = this.data.readUInt32LE(this.index);\n        const bin = this.data.slice(this.index, this.index + bsonSize);\n        this.documents.push(raw ? bin : BSON.deserialize(bin, _options));\n        this.index += bsonSize;\n      } else if (payloadType === 1) {\n        // It was decided that no driver makes use of payload type 1\n        throw new error_1.MongoDriverError('OP_MSG Payload Type 1 detected unsupported protocol');\n      }\n    }\n    if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\n      const fieldsAsRaw = {};\n      fieldsAsRaw[documentsReturnedIn] = true;\n      _options.fieldsAsRaw = fieldsAsRaw;\n      const doc = BSON.deserialize(this.documents[0], _options);\n      this.documents = [doc];\n    }\n    this.parsed = true;\n  }\n}\nexports.BinMsg = BinMsg;","map":{"version":3,"names":["read_preference_1","require","BSON","utils_1","constants_1","error_1","_requestId","OPTS_TAILABLE_CURSOR","OPTS_SLAVE","OPTS_OPLOG_REPLAY","OPTS_NO_CURSOR_TIMEOUT","OPTS_AWAIT_DATA","OPTS_EXHAUST","OPTS_PARTIAL","CURSOR_NOT_FOUND","QUERY_FAILURE","SHARD_CONFIG_STALE","AWAIT_CAPABLE","Query","constructor","ns","query","options","MongoDriverError","indexOf","numberToSkip","numberToReturn","returnFieldSelector","undefined","requestId","getRequestId","pre32Limit","serializeFunctions","ignoreUndefined","maxBsonSize","checkKeys","batchSize","tailable","slaveOk","oplogReplay","noCursorTimeout","awaitData","exhaust","partial","incRequestId","nextRequestId","toBin","buffers","projection","flags","header","Buffer","alloc","byteLength","push","serialize","Object","keys","length","totalLength","index","OP_QUERY","write","exports","GetMore","cursorId","opts","_buffer","OP_GETMORE","getLowBits","getHighBits","KillCursor","cursorIds","OP_KILL_CURSORS","i","Response","message","msgHeader","msgBody","parsed","raw","data","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","responseTo","opCode","fromCompressed","responseFlags","readInt32LE","Long","startingFrom","numberReturned","documents","Array","cursorNotFound","queryFailure","shardConfigStale","awaitCapable","isParsed","parse","documentsReturnedIn","_a","_b","_c","_d","bsonSize","_options","slice","deserialize","fieldsAsRaw","doc","OPTS_CHECKSUM_PRESENT","OPTS_MORE_TO_COME","OPTS_EXHAUST_ALLOWED","Msg","command","$db","databaseNamespace","readPreference","mode","ReadPreference","PRIMARY","$readPreference","toJSON","checksumPresent","moreToCome","exhaustAllowed","makeDocumentSegment","writeInt32LE","OP_MSG","writeUInt32LE","document","payloadTypeBuffer","documentBuffer","serializeBson","BinMsg","payloadType","readUInt8","readUInt32LE","bin"],"sources":["C:\\Users\\pranav kamat\\node_modules\\mongodb\\src\\cmap\\commands.ts"],"sourcesContent":["import { ReadPreference } from '../read_preference';\nimport * as BSON from '../bson';\nimport { databaseNamespace } from '../utils';\nimport { OP_QUERY, OP_GETMORE, OP_KILL_CURSORS, OP_MSG } from './wire_protocol/constants';\nimport type { Long, Document, BSONSerializeOptions } from '../bson';\nimport type { ClientSession } from '../sessions';\nimport type { CommandOptions } from './connection';\nimport { MongoDriverError } from '../error';\n\n// Incrementing request id\nlet _requestId = 0;\n\n// Query flags\nconst OPTS_TAILABLE_CURSOR = 2;\nconst OPTS_SLAVE = 4;\nconst OPTS_OPLOG_REPLAY = 8;\nconst OPTS_NO_CURSOR_TIMEOUT = 16;\nconst OPTS_AWAIT_DATA = 32;\nconst OPTS_EXHAUST = 64;\nconst OPTS_PARTIAL = 128;\n\n// Response flags\nconst CURSOR_NOT_FOUND = 1;\nconst QUERY_FAILURE = 2;\nconst SHARD_CONFIG_STALE = 4;\nconst AWAIT_CAPABLE = 8;\n\n/** @internal */\nexport type WriteProtocolMessageType = Query | Msg | GetMore | KillCursor;\n\n/** @internal */\nexport interface OpQueryOptions extends CommandOptions {\n  socketTimeoutMS?: number;\n  session?: ClientSession;\n  documentsReturnedIn?: string;\n  numberToSkip?: number;\n  numberToReturn?: number;\n  returnFieldSelector?: Document;\n  pre32Limit?: number;\n  serializeFunctions?: boolean;\n  ignoreUndefined?: boolean;\n  maxBsonSize?: number;\n  checkKeys?: boolean;\n  slaveOk?: boolean;\n\n  requestId?: number;\n  moreToCome?: boolean;\n  exhaustAllowed?: boolean;\n  readPreference?: ReadPreference;\n}\n\n/**************************************************************\n * QUERY\n **************************************************************/\n/** @internal */\nexport class Query {\n  ns: string;\n  query: Document;\n  numberToSkip: number;\n  numberToReturn: number;\n  returnFieldSelector?: Document;\n  requestId: number;\n  pre32Limit?: number;\n  serializeFunctions: boolean;\n  ignoreUndefined: boolean;\n  maxBsonSize: number;\n  checkKeys: boolean;\n  batchSize: number;\n  tailable: boolean;\n  slaveOk: boolean;\n  oplogReplay: boolean;\n  noCursorTimeout: boolean;\n  awaitData: boolean;\n  exhaust: boolean;\n  partial: boolean;\n  documentsReturnedIn?: string;\n\n  constructor(ns: string, query: Document, options: OpQueryOptions) {\n    // Basic options needed to be passed in\n    if (ns == null) throw new MongoDriverError('ns must be specified for query');\n    if (query == null) throw new MongoDriverError('query must be specified for query');\n\n    // Validate that we are not passing 0x00 in the collection name\n    if (ns.indexOf('\\x00') !== -1) {\n      throw new MongoDriverError('namespace cannot contain a null character');\n    }\n\n    // Basic options\n    this.ns = ns;\n    this.query = query;\n\n    // Additional options\n    this.numberToSkip = options.numberToSkip || 0;\n    this.numberToReturn = options.numberToReturn || 0;\n    this.returnFieldSelector = options.returnFieldSelector || undefined;\n    this.requestId = Query.getRequestId();\n\n    // special case for pre-3.2 find commands, delete ASAP\n    this.pre32Limit = options.pre32Limit;\n\n    // Serialization option\n    this.serializeFunctions =\n      typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n    this.ignoreUndefined =\n      typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n    this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n    this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n    this.batchSize = this.numberToReturn;\n\n    // Flags\n    this.tailable = false;\n    this.slaveOk = typeof options.slaveOk === 'boolean' ? options.slaveOk : false;\n    this.oplogReplay = false;\n    this.noCursorTimeout = false;\n    this.awaitData = false;\n    this.exhaust = false;\n    this.partial = false;\n  }\n\n  /** Assign next request Id. */\n  incRequestId(): void {\n    this.requestId = _requestId++;\n  }\n\n  /** Peek next request Id. */\n  nextRequestId(): number {\n    return _requestId + 1;\n  }\n\n  /** Increment then return next request Id. */\n  static getRequestId(): number {\n    return ++_requestId;\n  }\n\n  // Uses a single allocated buffer for the process, avoiding multiple memory allocations\n  toBin(): Buffer[] {\n    const buffers = [];\n    let projection = null;\n\n    // Set up the flags\n    let flags = 0;\n    if (this.tailable) {\n      flags |= OPTS_TAILABLE_CURSOR;\n    }\n\n    if (this.slaveOk) {\n      flags |= OPTS_SLAVE;\n    }\n\n    if (this.oplogReplay) {\n      flags |= OPTS_OPLOG_REPLAY;\n    }\n\n    if (this.noCursorTimeout) {\n      flags |= OPTS_NO_CURSOR_TIMEOUT;\n    }\n\n    if (this.awaitData) {\n      flags |= OPTS_AWAIT_DATA;\n    }\n\n    if (this.exhaust) {\n      flags |= OPTS_EXHAUST;\n    }\n\n    if (this.partial) {\n      flags |= OPTS_PARTIAL;\n    }\n\n    // If batchSize is different to this.numberToReturn\n    if (this.batchSize !== this.numberToReturn) this.numberToReturn = this.batchSize;\n\n    // Allocate write protocol header buffer\n    const header = Buffer.alloc(\n      4 * 4 + // Header\n        4 + // Flags\n        Buffer.byteLength(this.ns) +\n        1 + // namespace\n        4 + // numberToSkip\n        4 // numberToReturn\n    );\n\n    // Add header to buffers\n    buffers.push(header);\n\n    // Serialize the query\n    const query = BSON.serialize(this.query, {\n      checkKeys: this.checkKeys,\n      serializeFunctions: this.serializeFunctions,\n      ignoreUndefined: this.ignoreUndefined\n    });\n\n    // Add query document\n    buffers.push(query);\n\n    if (this.returnFieldSelector && Object.keys(this.returnFieldSelector).length > 0) {\n      // Serialize the projection document\n      projection = BSON.serialize(this.returnFieldSelector, {\n        checkKeys: this.checkKeys,\n        serializeFunctions: this.serializeFunctions,\n        ignoreUndefined: this.ignoreUndefined\n      });\n      // Add projection document\n      buffers.push(projection);\n    }\n\n    // Total message size\n    const totalLength = header.length + query.length + (projection ? projection.length : 0);\n\n    // Set up the index\n    let index = 4;\n\n    // Write total document length\n    header[3] = (totalLength >> 24) & 0xff;\n    header[2] = (totalLength >> 16) & 0xff;\n    header[1] = (totalLength >> 8) & 0xff;\n    header[0] = totalLength & 0xff;\n\n    // Write header information requestId\n    header[index + 3] = (this.requestId >> 24) & 0xff;\n    header[index + 2] = (this.requestId >> 16) & 0xff;\n    header[index + 1] = (this.requestId >> 8) & 0xff;\n    header[index] = this.requestId & 0xff;\n    index = index + 4;\n\n    // Write header information responseTo\n    header[index + 3] = (0 >> 24) & 0xff;\n    header[index + 2] = (0 >> 16) & 0xff;\n    header[index + 1] = (0 >> 8) & 0xff;\n    header[index] = 0 & 0xff;\n    index = index + 4;\n\n    // Write header information OP_QUERY\n    header[index + 3] = (OP_QUERY >> 24) & 0xff;\n    header[index + 2] = (OP_QUERY >> 16) & 0xff;\n    header[index + 1] = (OP_QUERY >> 8) & 0xff;\n    header[index] = OP_QUERY & 0xff;\n    index = index + 4;\n\n    // Write header information flags\n    header[index + 3] = (flags >> 24) & 0xff;\n    header[index + 2] = (flags >> 16) & 0xff;\n    header[index + 1] = (flags >> 8) & 0xff;\n    header[index] = flags & 0xff;\n    index = index + 4;\n\n    // Write collection name\n    index = index + header.write(this.ns, index, 'utf8') + 1;\n    header[index - 1] = 0;\n\n    // Write header information flags numberToSkip\n    header[index + 3] = (this.numberToSkip >> 24) & 0xff;\n    header[index + 2] = (this.numberToSkip >> 16) & 0xff;\n    header[index + 1] = (this.numberToSkip >> 8) & 0xff;\n    header[index] = this.numberToSkip & 0xff;\n    index = index + 4;\n\n    // Write header information flags numberToReturn\n    header[index + 3] = (this.numberToReturn >> 24) & 0xff;\n    header[index + 2] = (this.numberToReturn >> 16) & 0xff;\n    header[index + 1] = (this.numberToReturn >> 8) & 0xff;\n    header[index] = this.numberToReturn & 0xff;\n    index = index + 4;\n\n    // Return the buffers\n    return buffers;\n  }\n}\n\n/** @internal */\nexport interface OpGetMoreOptions {\n  numberToReturn?: number;\n}\n\n/**************************************************************\n * GETMORE\n **************************************************************/\n/** @internal */\nexport class GetMore {\n  numberToReturn: number;\n  requestId: number;\n  ns: string;\n  cursorId: Long;\n\n  constructor(ns: string, cursorId: Long, opts: OpGetMoreOptions = {}) {\n    this.numberToReturn = opts.numberToReturn || 0;\n    this.requestId = _requestId++;\n    this.ns = ns;\n    this.cursorId = cursorId;\n  }\n\n  // Uses a single allocated buffer for the process, avoiding multiple memory allocations\n  toBin(): Buffer[] {\n    const length = 4 + Buffer.byteLength(this.ns) + 1 + 4 + 8 + 4 * 4;\n    // Create command buffer\n    let index = 0;\n    // Allocate buffer\n    const _buffer = Buffer.alloc(length);\n\n    // Write header information\n    // index = write32bit(index, _buffer, length);\n    _buffer[index + 3] = (length >> 24) & 0xff;\n    _buffer[index + 2] = (length >> 16) & 0xff;\n    _buffer[index + 1] = (length >> 8) & 0xff;\n    _buffer[index] = length & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, requestId);\n    _buffer[index + 3] = (this.requestId >> 24) & 0xff;\n    _buffer[index + 2] = (this.requestId >> 16) & 0xff;\n    _buffer[index + 1] = (this.requestId >> 8) & 0xff;\n    _buffer[index] = this.requestId & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, 0);\n    _buffer[index + 3] = (0 >> 24) & 0xff;\n    _buffer[index + 2] = (0 >> 16) & 0xff;\n    _buffer[index + 1] = (0 >> 8) & 0xff;\n    _buffer[index] = 0 & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, OP_GETMORE);\n    _buffer[index + 3] = (OP_GETMORE >> 24) & 0xff;\n    _buffer[index + 2] = (OP_GETMORE >> 16) & 0xff;\n    _buffer[index + 1] = (OP_GETMORE >> 8) & 0xff;\n    _buffer[index] = OP_GETMORE & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, 0);\n    _buffer[index + 3] = (0 >> 24) & 0xff;\n    _buffer[index + 2] = (0 >> 16) & 0xff;\n    _buffer[index + 1] = (0 >> 8) & 0xff;\n    _buffer[index] = 0 & 0xff;\n    index = index + 4;\n\n    // Write collection name\n    index = index + _buffer.write(this.ns, index, 'utf8') + 1;\n    _buffer[index - 1] = 0;\n\n    // Write batch size\n    // index = write32bit(index, _buffer, numberToReturn);\n    _buffer[index + 3] = (this.numberToReturn >> 24) & 0xff;\n    _buffer[index + 2] = (this.numberToReturn >> 16) & 0xff;\n    _buffer[index + 1] = (this.numberToReturn >> 8) & 0xff;\n    _buffer[index] = this.numberToReturn & 0xff;\n    index = index + 4;\n\n    // Write cursor id\n    // index = write32bit(index, _buffer, cursorId.getLowBits());\n    _buffer[index + 3] = (this.cursorId.getLowBits() >> 24) & 0xff;\n    _buffer[index + 2] = (this.cursorId.getLowBits() >> 16) & 0xff;\n    _buffer[index + 1] = (this.cursorId.getLowBits() >> 8) & 0xff;\n    _buffer[index] = this.cursorId.getLowBits() & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, cursorId.getHighBits());\n    _buffer[index + 3] = (this.cursorId.getHighBits() >> 24) & 0xff;\n    _buffer[index + 2] = (this.cursorId.getHighBits() >> 16) & 0xff;\n    _buffer[index + 1] = (this.cursorId.getHighBits() >> 8) & 0xff;\n    _buffer[index] = this.cursorId.getHighBits() & 0xff;\n    index = index + 4;\n\n    // Return buffer\n    return [_buffer];\n  }\n}\n\n/**************************************************************\n * KILLCURSOR\n **************************************************************/\n/** @internal */\nexport class KillCursor {\n  ns: string;\n  requestId: number;\n  cursorIds: Long[];\n\n  constructor(ns: string, cursorIds: Long[]) {\n    this.ns = ns;\n    this.requestId = _requestId++;\n    this.cursorIds = cursorIds;\n  }\n\n  // Uses a single allocated buffer for the process, avoiding multiple memory allocations\n  toBin(): Buffer[] {\n    const length = 4 + 4 + 4 * 4 + this.cursorIds.length * 8;\n\n    // Create command buffer\n    let index = 0;\n    const _buffer = Buffer.alloc(length);\n\n    // Write header information\n    // index = write32bit(index, _buffer, length);\n    _buffer[index + 3] = (length >> 24) & 0xff;\n    _buffer[index + 2] = (length >> 16) & 0xff;\n    _buffer[index + 1] = (length >> 8) & 0xff;\n    _buffer[index] = length & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, requestId);\n    _buffer[index + 3] = (this.requestId >> 24) & 0xff;\n    _buffer[index + 2] = (this.requestId >> 16) & 0xff;\n    _buffer[index + 1] = (this.requestId >> 8) & 0xff;\n    _buffer[index] = this.requestId & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, 0);\n    _buffer[index + 3] = (0 >> 24) & 0xff;\n    _buffer[index + 2] = (0 >> 16) & 0xff;\n    _buffer[index + 1] = (0 >> 8) & 0xff;\n    _buffer[index] = 0 & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, OP_KILL_CURSORS);\n    _buffer[index + 3] = (OP_KILL_CURSORS >> 24) & 0xff;\n    _buffer[index + 2] = (OP_KILL_CURSORS >> 16) & 0xff;\n    _buffer[index + 1] = (OP_KILL_CURSORS >> 8) & 0xff;\n    _buffer[index] = OP_KILL_CURSORS & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, 0);\n    _buffer[index + 3] = (0 >> 24) & 0xff;\n    _buffer[index + 2] = (0 >> 16) & 0xff;\n    _buffer[index + 1] = (0 >> 8) & 0xff;\n    _buffer[index] = 0 & 0xff;\n    index = index + 4;\n\n    // Write batch size\n    // index = write32bit(index, _buffer, this.cursorIds.length);\n    _buffer[index + 3] = (this.cursorIds.length >> 24) & 0xff;\n    _buffer[index + 2] = (this.cursorIds.length >> 16) & 0xff;\n    _buffer[index + 1] = (this.cursorIds.length >> 8) & 0xff;\n    _buffer[index] = this.cursorIds.length & 0xff;\n    index = index + 4;\n\n    // Write all the cursor ids into the array\n    for (let i = 0; i < this.cursorIds.length; i++) {\n      // Write cursor id\n      // index = write32bit(index, _buffer, cursorIds[i].getLowBits());\n      _buffer[index + 3] = (this.cursorIds[i].getLowBits() >> 24) & 0xff;\n      _buffer[index + 2] = (this.cursorIds[i].getLowBits() >> 16) & 0xff;\n      _buffer[index + 1] = (this.cursorIds[i].getLowBits() >> 8) & 0xff;\n      _buffer[index] = this.cursorIds[i].getLowBits() & 0xff;\n      index = index + 4;\n\n      // index = write32bit(index, _buffer, cursorIds[i].getHighBits());\n      _buffer[index + 3] = (this.cursorIds[i].getHighBits() >> 24) & 0xff;\n      _buffer[index + 2] = (this.cursorIds[i].getHighBits() >> 16) & 0xff;\n      _buffer[index + 1] = (this.cursorIds[i].getHighBits() >> 8) & 0xff;\n      _buffer[index] = this.cursorIds[i].getHighBits() & 0xff;\n      index = index + 4;\n    }\n\n    // Return buffer\n    return [_buffer];\n  }\n}\n\nexport interface MessageHeader {\n  length: number;\n  requestId: number;\n  responseTo: number;\n  opCode: number;\n  fromCompressed?: boolean;\n}\n\nexport interface OpResponseOptions extends BSONSerializeOptions {\n  raw?: boolean;\n  documentsReturnedIn?: string | null;\n}\n\n/** @internal */\nexport class Response {\n  parsed: boolean;\n  raw: Buffer;\n  data: Buffer;\n  opts: OpResponseOptions;\n  length: number;\n  requestId: number;\n  responseTo: number;\n  opCode: number;\n  fromCompressed?: boolean;\n  responseFlags: number;\n  cursorId: Long;\n  startingFrom: number;\n  numberReturned: number;\n  documents: (Document | Buffer)[];\n  cursorNotFound: boolean;\n  queryFailure: boolean;\n  shardConfigStale: boolean;\n  awaitCapable: boolean;\n  promoteLongs: boolean;\n  promoteValues: boolean;\n  promoteBuffers: boolean;\n  bsonRegExp?: boolean;\n  index?: number;\n\n  constructor(\n    message: Buffer,\n    msgHeader: MessageHeader,\n    msgBody: Buffer,\n    opts?: OpResponseOptions\n  ) {\n    this.parsed = false;\n    this.raw = message;\n    this.data = msgBody;\n    this.opts = opts ?? {\n      promoteLongs: true,\n      promoteValues: true,\n      promoteBuffers: false,\n      bsonRegExp: false\n    };\n\n    // Read the message header\n    this.length = msgHeader.length;\n    this.requestId = msgHeader.requestId;\n    this.responseTo = msgHeader.responseTo;\n    this.opCode = msgHeader.opCode;\n    this.fromCompressed = msgHeader.fromCompressed;\n\n    // Read the message body\n    this.responseFlags = msgBody.readInt32LE(0);\n    this.cursorId = new BSON.Long(msgBody.readInt32LE(4), msgBody.readInt32LE(8));\n    this.startingFrom = msgBody.readInt32LE(12);\n    this.numberReturned = msgBody.readInt32LE(16);\n\n    // Preallocate document array\n    this.documents = new Array(this.numberReturned);\n\n    // Flag values\n    this.cursorNotFound = (this.responseFlags & CURSOR_NOT_FOUND) !== 0;\n    this.queryFailure = (this.responseFlags & QUERY_FAILURE) !== 0;\n    this.shardConfigStale = (this.responseFlags & SHARD_CONFIG_STALE) !== 0;\n    this.awaitCapable = (this.responseFlags & AWAIT_CAPABLE) !== 0;\n    this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n    this.promoteValues =\n      typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n    this.promoteBuffers =\n      typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n    this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n  }\n\n  isParsed(): boolean {\n    return this.parsed;\n  }\n\n  parse(options: OpResponseOptions): void {\n    // Don't parse again if not needed\n    if (this.parsed) return;\n    options = options ?? {};\n\n    // Allow the return of raw documents instead of parsing\n    const raw = options.raw || false;\n    const documentsReturnedIn = options.documentsReturnedIn || null;\n    const promoteLongs = options.promoteLongs ?? this.opts.promoteLongs;\n    const promoteValues = options.promoteValues ?? this.opts.promoteValues;\n    const promoteBuffers = options.promoteBuffers ?? this.opts.promoteBuffers;\n    const bsonRegExp = options.bsonRegExp ?? this.opts.bsonRegExp;\n    let bsonSize;\n\n    // Set up the options\n    const _options: BSONSerializeOptions = {\n      promoteLongs,\n      promoteValues,\n      promoteBuffers,\n      bsonRegExp\n    };\n\n    // Position within OP_REPLY at which documents start\n    // (See https://docs.mongodb.com/manual/reference/mongodb-wire-protocol/#wire-op-reply)\n    this.index = 20;\n\n    // Parse Body\n    for (let i = 0; i < this.numberReturned; i++) {\n      bsonSize =\n        this.data[this.index] |\n        (this.data[this.index + 1] << 8) |\n        (this.data[this.index + 2] << 16) |\n        (this.data[this.index + 3] << 24);\n\n      // If we have raw results specified slice the return document\n      if (raw) {\n        this.documents[i] = this.data.slice(this.index, this.index + bsonSize);\n      } else {\n        this.documents[i] = BSON.deserialize(\n          this.data.slice(this.index, this.index + bsonSize),\n          _options\n        );\n      }\n\n      // Adjust the index\n      this.index = this.index + bsonSize;\n    }\n\n    if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\n      const fieldsAsRaw: Document = {};\n      fieldsAsRaw[documentsReturnedIn] = true;\n      _options.fieldsAsRaw = fieldsAsRaw;\n\n      const doc = BSON.deserialize(this.documents[0] as Buffer, _options);\n      this.documents = [doc];\n    }\n\n    // Set parsed\n    this.parsed = true;\n  }\n}\n\n// Implementation of OP_MSG spec:\n// https://github.com/mongodb/specifications/blob/master/source/message/OP_MSG.rst\n//\n// struct Section {\n//   uint8 payloadType;\n//   union payload {\n//       document  document; // payloadType == 0\n//       struct sequence { // payloadType == 1\n//           int32      size;\n//           cstring    identifier;\n//           document*  documents;\n//       };\n//   };\n// };\n\n// struct OP_MSG {\n//   struct MsgHeader {\n//       int32  messageLength;\n//       int32  requestID;\n//       int32  responseTo;\n//       int32  opCode = 2013;\n//   };\n//   uint32      flagBits;\n//   Section+    sections;\n//   [uint32     checksum;]\n// };\n\n// Msg Flags\nconst OPTS_CHECKSUM_PRESENT = 1;\nconst OPTS_MORE_TO_COME = 2;\nconst OPTS_EXHAUST_ALLOWED = 1 << 16;\n\nexport interface OpMsgOptions {\n  requestId: number;\n  serializeFunctions: boolean;\n  ignoreUndefined: boolean;\n  checkKeys: boolean;\n  maxBsonSize: number;\n  moreToCome: boolean;\n  exhaustAllowed: boolean;\n  readPreference: ReadPreference;\n}\n\n/** @internal */\nexport class Msg {\n  ns: string;\n  command: Document;\n  options: OpQueryOptions;\n  requestId: number;\n  serializeFunctions: boolean;\n  ignoreUndefined: boolean;\n  checkKeys: boolean;\n  maxBsonSize: number;\n  checksumPresent: boolean;\n  moreToCome: boolean;\n  exhaustAllowed: boolean;\n\n  constructor(ns: string, command: Document, options: OpQueryOptions) {\n    // Basic options needed to be passed in\n    if (command == null) throw new MongoDriverError('query must be specified for query');\n\n    // Basic options\n    this.ns = ns;\n    this.command = command;\n    this.command.$db = databaseNamespace(ns);\n\n    if (options.readPreference && options.readPreference.mode !== ReadPreference.PRIMARY) {\n      this.command.$readPreference = options.readPreference.toJSON();\n    }\n\n    // Ensure empty options\n    this.options = options ?? {};\n\n    // Additional options\n    this.requestId = options.requestId ? options.requestId : Msg.getRequestId();\n\n    // Serialization option\n    this.serializeFunctions =\n      typeof options.serializeFunctions === 'boolean' ? options.serializeFunctions : false;\n    this.ignoreUndefined =\n      typeof options.ignoreUndefined === 'boolean' ? options.ignoreUndefined : false;\n    this.checkKeys = typeof options.checkKeys === 'boolean' ? options.checkKeys : false;\n    this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n\n    // flags\n    this.checksumPresent = false;\n    this.moreToCome = options.moreToCome || false;\n    this.exhaustAllowed =\n      typeof options.exhaustAllowed === 'boolean' ? options.exhaustAllowed : false;\n  }\n\n  toBin(): Buffer[] {\n    const buffers: Buffer[] = [];\n    let flags = 0;\n\n    if (this.checksumPresent) {\n      flags |= OPTS_CHECKSUM_PRESENT;\n    }\n\n    if (this.moreToCome) {\n      flags |= OPTS_MORE_TO_COME;\n    }\n\n    if (this.exhaustAllowed) {\n      flags |= OPTS_EXHAUST_ALLOWED;\n    }\n\n    const header = Buffer.alloc(\n      4 * 4 + // Header\n        4 // Flags\n    );\n\n    buffers.push(header);\n\n    let totalLength = header.length;\n    const command = this.command;\n    totalLength += this.makeDocumentSegment(buffers, command);\n\n    header.writeInt32LE(totalLength, 0); // messageLength\n    header.writeInt32LE(this.requestId, 4); // requestID\n    header.writeInt32LE(0, 8); // responseTo\n    header.writeInt32LE(OP_MSG, 12); // opCode\n    header.writeUInt32LE(flags, 16); // flags\n    return buffers;\n  }\n\n  makeDocumentSegment(buffers: Buffer[], document: Document): number {\n    const payloadTypeBuffer = Buffer.alloc(1);\n    payloadTypeBuffer[0] = 0;\n\n    const documentBuffer = this.serializeBson(document);\n    buffers.push(payloadTypeBuffer);\n    buffers.push(documentBuffer);\n\n    return payloadTypeBuffer.length + documentBuffer.length;\n  }\n\n  serializeBson(document: Document): Buffer {\n    return BSON.serialize(document, {\n      checkKeys: this.checkKeys,\n      serializeFunctions: this.serializeFunctions,\n      ignoreUndefined: this.ignoreUndefined\n    });\n  }\n\n  static getRequestId(): number {\n    _requestId = (_requestId + 1) & 0x7fffffff;\n    return _requestId;\n  }\n}\n\n/** @internal */\nexport class BinMsg {\n  parsed: boolean;\n  raw: Buffer;\n  data: Buffer;\n  opts: OpResponseOptions;\n  length: number;\n  requestId: number;\n  responseTo: number;\n  opCode: number;\n  fromCompressed?: boolean;\n  responseFlags: number;\n  checksumPresent: boolean;\n  moreToCome: boolean;\n  exhaustAllowed: boolean;\n  promoteLongs: boolean;\n  promoteValues: boolean;\n  promoteBuffers: boolean;\n  bsonRegExp: boolean;\n  documents: (Document | Buffer)[];\n  index?: number;\n\n  constructor(\n    message: Buffer,\n    msgHeader: MessageHeader,\n    msgBody: Buffer,\n    opts?: OpResponseOptions\n  ) {\n    this.parsed = false;\n    this.raw = message;\n    this.data = msgBody;\n    this.opts = opts ?? {\n      promoteLongs: true,\n      promoteValues: true,\n      promoteBuffers: false,\n      bsonRegExp: false\n    };\n\n    // Read the message header\n    this.length = msgHeader.length;\n    this.requestId = msgHeader.requestId;\n    this.responseTo = msgHeader.responseTo;\n    this.opCode = msgHeader.opCode;\n    this.fromCompressed = msgHeader.fromCompressed;\n\n    // Read response flags\n    this.responseFlags = msgBody.readInt32LE(0);\n    this.checksumPresent = (this.responseFlags & OPTS_CHECKSUM_PRESENT) !== 0;\n    this.moreToCome = (this.responseFlags & OPTS_MORE_TO_COME) !== 0;\n    this.exhaustAllowed = (this.responseFlags & OPTS_EXHAUST_ALLOWED) !== 0;\n    this.promoteLongs = typeof this.opts.promoteLongs === 'boolean' ? this.opts.promoteLongs : true;\n    this.promoteValues =\n      typeof this.opts.promoteValues === 'boolean' ? this.opts.promoteValues : true;\n    this.promoteBuffers =\n      typeof this.opts.promoteBuffers === 'boolean' ? this.opts.promoteBuffers : false;\n    this.bsonRegExp = typeof this.opts.bsonRegExp === 'boolean' ? this.opts.bsonRegExp : false;\n\n    this.documents = [];\n  }\n\n  isParsed(): boolean {\n    return this.parsed;\n  }\n\n  parse(options: OpResponseOptions): void {\n    // Don't parse again if not needed\n    if (this.parsed) return;\n    options = options ?? {};\n\n    this.index = 4;\n    // Allow the return of raw documents instead of parsing\n    const raw = options.raw || false;\n    const documentsReturnedIn = options.documentsReturnedIn || null;\n    const promoteLongs = options.promoteLongs ?? this.opts.promoteLongs;\n    const promoteValues = options.promoteValues ?? this.opts.promoteValues;\n    const promoteBuffers = options.promoteBuffers ?? this.opts.promoteBuffers;\n    const bsonRegExp = options.bsonRegExp ?? this.opts.bsonRegExp;\n\n    // Set up the options\n    const _options: BSONSerializeOptions = {\n      promoteLongs,\n      promoteValues,\n      promoteBuffers,\n      bsonRegExp\n    };\n\n    while (this.index < this.data.length) {\n      const payloadType = this.data.readUInt8(this.index++);\n      if (payloadType === 0) {\n        const bsonSize = this.data.readUInt32LE(this.index);\n        const bin = this.data.slice(this.index, this.index + bsonSize);\n        this.documents.push(raw ? bin : BSON.deserialize(bin, _options));\n\n        this.index += bsonSize;\n      } else if (payloadType === 1) {\n        // It was decided that no driver makes use of payload type 1\n        throw new MongoDriverError('OP_MSG Payload Type 1 detected unsupported protocol');\n      }\n    }\n\n    if (this.documents.length === 1 && documentsReturnedIn != null && raw) {\n      const fieldsAsRaw: Document = {};\n      fieldsAsRaw[documentsReturnedIn] = true;\n      _options.fieldsAsRaw = fieldsAsRaw;\n\n      const doc = BSON.deserialize(this.documents[0] as Buffer, _options);\n      this.documents = [doc];\n    }\n\n    this.parsed = true;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}