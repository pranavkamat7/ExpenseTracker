{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MongoDBAWS = void 0;\nconst http = require(\"http\");\nconst crypto = require(\"crypto\");\nconst url = require(\"url\");\nconst BSON = require(\"../../bson\");\nconst auth_provider_1 = require(\"./auth_provider\");\nconst mongo_credentials_1 = require(\"./mongo_credentials\");\nconst error_1 = require(\"../../error\");\nconst utils_1 = require(\"../../utils\");\nconst deps_1 = require(\"../../deps\");\nconst defaultAuthProviders_1 = require(\"./defaultAuthProviders\");\nconst ASCII_N = 110;\nconst AWS_RELATIVE_URI = 'http://169.254.170.2';\nconst AWS_EC2_URI = 'http://169.254.169.254';\nconst AWS_EC2_PATH = '/latest/meta-data/iam/security-credentials';\nconst bsonOptions = {\n  promoteLongs: true,\n  promoteValues: true,\n  promoteBuffers: false,\n  bsonRegExp: false\n};\nclass MongoDBAWS extends auth_provider_1.AuthProvider {\n  auth(authContext, callback) {\n    const {\n      connection,\n      credentials\n    } = authContext;\n    if (!credentials) {\n      return callback(new error_1.MongoDriverError('AuthContext must provide credentials.'));\n    }\n    if ('kModuleError' in deps_1.aws4) {\n      return callback(deps_1.aws4['kModuleError']);\n    }\n    const {\n      sign\n    } = deps_1.aws4;\n    if (utils_1.maxWireVersion(connection) < 9) {\n      callback(new error_1.MongoDriverError('MONGODB-AWS authentication requires MongoDB version 4.4 or later'));\n      return;\n    }\n    if (!credentials.username) {\n      makeTempCredentials(credentials, (err, tempCredentials) => {\n        if (err || !tempCredentials) return callback(err);\n        authContext.credentials = tempCredentials;\n        this.auth(authContext, callback);\n      });\n      return;\n    }\n    const username = credentials.username;\n    const password = credentials.password;\n    const db = credentials.source;\n    const token = credentials.mechanismProperties.AWS_SESSION_TOKEN;\n    crypto.randomBytes(32, (err, nonce) => {\n      if (err) {\n        callback(err);\n        return;\n      }\n      const saslStart = {\n        saslStart: 1,\n        mechanism: 'MONGODB-AWS',\n        payload: BSON.serialize({\n          r: nonce,\n          p: ASCII_N\n        }, bsonOptions)\n      };\n      connection.command(utils_1.ns(`${db}.$cmd`), saslStart, undefined, (err, res) => {\n        if (err) return callback(err);\n        const serverResponse = BSON.deserialize(res.payload.buffer, bsonOptions);\n        const host = serverResponse.h;\n        const serverNonce = serverResponse.s.buffer;\n        if (serverNonce.length !== 64) {\n          callback(new error_1.MongoDriverError(`Invalid server nonce length ${serverNonce.length}, expected 64`));\n          return;\n        }\n        if (serverNonce.compare(nonce, 0, nonce.length, 0, nonce.length) !== 0) {\n          callback(new error_1.MongoDriverError('Server nonce does not begin with client nonce'));\n          return;\n        }\n        if (host.length < 1 || host.length > 255 || host.indexOf('..') !== -1) {\n          callback(new error_1.MongoDriverError(`Server returned an invalid host: \"${host}\"`));\n          return;\n        }\n        const body = 'Action=GetCallerIdentity&Version=2011-06-15';\n        const options = sign({\n          method: 'POST',\n          host,\n          region: deriveRegion(serverResponse.h),\n          service: 'sts',\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'Content-Length': body.length,\n            'X-MongoDB-Server-Nonce': serverNonce.toString('base64'),\n            'X-MongoDB-GS2-CB-Flag': 'n'\n          },\n          path: '/',\n          body\n        }, {\n          accessKeyId: username,\n          secretAccessKey: password,\n          token\n        });\n        const authorization = options.headers.Authorization;\n        const date = options.headers['X-Amz-Date'];\n        const payload = {\n          a: authorization,\n          d: date\n        };\n        if (token) {\n          payload.t = token;\n        }\n        const saslContinue = {\n          saslContinue: 1,\n          conversationId: 1,\n          payload: BSON.serialize(payload, bsonOptions)\n        };\n        connection.command(utils_1.ns(`${db}.$cmd`), saslContinue, undefined, callback);\n      });\n    });\n  }\n}\nexports.MongoDBAWS = MongoDBAWS;\nfunction makeTempCredentials(credentials, callback) {\n  function done(creds) {\n    if (!creds.AccessKeyId || !creds.SecretAccessKey || !creds.Token) {\n      callback(new error_1.MongoDriverError('Could not obtain temporary MONGODB-AWS credentials'));\n      return;\n    }\n    callback(undefined, new mongo_credentials_1.MongoCredentials({\n      username: creds.AccessKeyId,\n      password: creds.SecretAccessKey,\n      source: credentials.source,\n      mechanism: defaultAuthProviders_1.AuthMechanism.MONGODB_AWS,\n      mechanismProperties: {\n        AWS_SESSION_TOKEN: creds.Token\n      }\n    }));\n  }\n  // If the environment variable AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\n  // is set then drivers MUST assume that it was set by an AWS ECS agent\n  if (process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI) {\n    request(`${AWS_RELATIVE_URI}${process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI}`, (err, res) => {\n      if (err) return callback(err);\n      done(res);\n    });\n    return;\n  }\n  // Otherwise assume we are on an EC2 instance\n  // get a token\n  request(`${AWS_EC2_URI}/latest/api/token`, {\n    method: 'PUT',\n    json: false,\n    headers: {\n      'X-aws-ec2-metadata-token-ttl-seconds': 30\n    }\n  }, (err, token) => {\n    if (err) return callback(err);\n    // get role name\n    request(`${AWS_EC2_URI}/${AWS_EC2_PATH}`, {\n      json: false,\n      headers: {\n        'X-aws-ec2-metadata-token': token\n      }\n    }, (err, roleName) => {\n      if (err) return callback(err);\n      // get temp credentials\n      request(`${AWS_EC2_URI}/${AWS_EC2_PATH}/${roleName}`, {\n        headers: {\n          'X-aws-ec2-metadata-token': token\n        }\n      }, (err, creds) => {\n        if (err) return callback(err);\n        done(creds);\n      });\n    });\n  });\n}\nfunction deriveRegion(host) {\n  const parts = host.split('.');\n  if (parts.length === 1 || parts[1] === 'amazonaws') {\n    return 'us-east-1';\n  }\n  return parts[1];\n}\nfunction request(uri, _options, _callback) {\n  let options = _options;\n  if ('function' === typeof _options) {\n    options = {};\n  }\n  let callback = _options;\n  if (_callback) {\n    callback = _callback;\n  }\n  options = Object.assign({\n    method: 'GET',\n    timeout: 10000,\n    json: true\n  }, url.parse(uri), options);\n  const req = http.request(options, res => {\n    res.setEncoding('utf8');\n    let data = '';\n    res.on('data', d => data += d);\n    res.on('end', () => {\n      if (options.json === false) {\n        callback(undefined, data);\n        return;\n      }\n      try {\n        const parsed = JSON.parse(data);\n        callback(undefined, parsed);\n      } catch (err) {\n        callback(new error_1.MongoDriverError(`Invalid JSON response: \"${data}\"`));\n      }\n    });\n  });\n  req.on('error', err => callback(err));\n  req.end();\n}","map":{"version":3,"names":["http","require","crypto","url","BSON","auth_provider_1","mongo_credentials_1","error_1","utils_1","deps_1","defaultAuthProviders_1","ASCII_N","AWS_RELATIVE_URI","AWS_EC2_URI","AWS_EC2_PATH","bsonOptions","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","MongoDBAWS","AuthProvider","auth","authContext","callback","connection","credentials","MongoDriverError","aws4","sign","maxWireVersion","username","makeTempCredentials","err","tempCredentials","password","db","source","token","mechanismProperties","AWS_SESSION_TOKEN","randomBytes","nonce","saslStart","mechanism","payload","serialize","r","p","command","ns","undefined","res","serverResponse","deserialize","buffer","host","h","serverNonce","s","length","compare","indexOf","body","options","method","region","deriveRegion","service","headers","toString","path","accessKeyId","secretAccessKey","authorization","Authorization","date","a","d","t","saslContinue","conversationId","exports","done","creds","AccessKeyId","SecretAccessKey","Token","MongoCredentials","AuthMechanism","MONGODB_AWS","process","env","AWS_CONTAINER_CREDENTIALS_RELATIVE_URI","request","json","roleName","parts","split","uri","_options","_callback","Object","assign","timeout","parse","req","setEncoding","data","on","parsed","JSON","end"],"sources":["C:\\Users\\pranav kamat\\node_modules\\mongodb\\src\\cmap\\auth\\mongodb_aws.ts"],"sourcesContent":["import * as http from 'http';\nimport * as crypto from 'crypto';\nimport * as url from 'url';\nimport * as BSON from '../../bson';\nimport { AuthProvider, AuthContext } from './auth_provider';\nimport { MongoCredentials } from './mongo_credentials';\nimport { MongoDriverError } from '../../error';\nimport { maxWireVersion, Callback, ns } from '../../utils';\nimport type { BSONSerializeOptions } from '../../bson';\n\nimport { aws4 } from '../../deps';\nimport { AuthMechanism } from './defaultAuthProviders';\n\nconst ASCII_N = 110;\nconst AWS_RELATIVE_URI = 'http://169.254.170.2';\nconst AWS_EC2_URI = 'http://169.254.169.254';\nconst AWS_EC2_PATH = '/latest/meta-data/iam/security-credentials';\nconst bsonOptions: BSONSerializeOptions = {\n  promoteLongs: true,\n  promoteValues: true,\n  promoteBuffers: false,\n  bsonRegExp: false\n};\n\ninterface AWSSaslContinuePayload {\n  a: string;\n  d: string;\n  t?: string;\n}\n\nexport class MongoDBAWS extends AuthProvider {\n  auth(authContext: AuthContext, callback: Callback): void {\n    const { connection, credentials } = authContext;\n    if (!credentials) {\n      return callback(new MongoDriverError('AuthContext must provide credentials.'));\n    }\n\n    if ('kModuleError' in aws4) {\n      return callback(aws4['kModuleError']);\n    }\n    const { sign } = aws4;\n\n    if (maxWireVersion(connection) < 9) {\n      callback(\n        new MongoDriverError('MONGODB-AWS authentication requires MongoDB version 4.4 or later')\n      );\n      return;\n    }\n\n    if (!credentials.username) {\n      makeTempCredentials(credentials, (err, tempCredentials) => {\n        if (err || !tempCredentials) return callback(err);\n\n        authContext.credentials = tempCredentials;\n        this.auth(authContext, callback);\n      });\n\n      return;\n    }\n\n    const username = credentials.username;\n    const password = credentials.password;\n    const db = credentials.source;\n    const token = credentials.mechanismProperties.AWS_SESSION_TOKEN;\n    crypto.randomBytes(32, (err, nonce) => {\n      if (err) {\n        callback(err);\n        return;\n      }\n\n      const saslStart = {\n        saslStart: 1,\n        mechanism: 'MONGODB-AWS',\n        payload: BSON.serialize({ r: nonce, p: ASCII_N }, bsonOptions)\n      };\n\n      connection.command(ns(`${db}.$cmd`), saslStart, undefined, (err, res) => {\n        if (err) return callback(err);\n\n        const serverResponse = BSON.deserialize(res.payload.buffer, bsonOptions);\n        const host = serverResponse.h;\n        const serverNonce = serverResponse.s.buffer;\n        if (serverNonce.length !== 64) {\n          callback(\n            new MongoDriverError(`Invalid server nonce length ${serverNonce.length}, expected 64`)\n          );\n\n          return;\n        }\n\n        if (serverNonce.compare(nonce, 0, nonce.length, 0, nonce.length) !== 0) {\n          callback(new MongoDriverError('Server nonce does not begin with client nonce'));\n          return;\n        }\n\n        if (host.length < 1 || host.length > 255 || host.indexOf('..') !== -1) {\n          callback(new MongoDriverError(`Server returned an invalid host: \"${host}\"`));\n          return;\n        }\n\n        const body = 'Action=GetCallerIdentity&Version=2011-06-15';\n        const options = sign(\n          {\n            method: 'POST',\n            host,\n            region: deriveRegion(serverResponse.h),\n            service: 'sts',\n            headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'Content-Length': body.length,\n              'X-MongoDB-Server-Nonce': serverNonce.toString('base64'),\n              'X-MongoDB-GS2-CB-Flag': 'n'\n            },\n            path: '/',\n            body\n          },\n          {\n            accessKeyId: username,\n            secretAccessKey: password,\n            token\n          }\n        );\n\n        const authorization = options.headers.Authorization;\n        const date = options.headers['X-Amz-Date'];\n        const payload: AWSSaslContinuePayload = { a: authorization, d: date };\n        if (token) {\n          payload.t = token;\n        }\n\n        const saslContinue = {\n          saslContinue: 1,\n          conversationId: 1,\n          payload: BSON.serialize(payload, bsonOptions)\n        };\n\n        connection.command(ns(`${db}.$cmd`), saslContinue, undefined, callback);\n      });\n    });\n  }\n}\n\ninterface AWSCredentials {\n  AccessKeyId?: string;\n  SecretAccessKey?: string;\n  Token?: string;\n}\n\nfunction makeTempCredentials(credentials: MongoCredentials, callback: Callback<MongoCredentials>) {\n  function done(creds: AWSCredentials) {\n    if (!creds.AccessKeyId || !creds.SecretAccessKey || !creds.Token) {\n      callback(new MongoDriverError('Could not obtain temporary MONGODB-AWS credentials'));\n      return;\n    }\n\n    callback(\n      undefined,\n      new MongoCredentials({\n        username: creds.AccessKeyId,\n        password: creds.SecretAccessKey,\n        source: credentials.source,\n        mechanism: AuthMechanism.MONGODB_AWS,\n        mechanismProperties: {\n          AWS_SESSION_TOKEN: creds.Token\n        }\n      })\n    );\n  }\n\n  // If the environment variable AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\n  // is set then drivers MUST assume that it was set by an AWS ECS agent\n  if (process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI) {\n    request(\n      `${AWS_RELATIVE_URI}${process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI}`,\n      (err, res) => {\n        if (err) return callback(err);\n        done(res);\n      }\n    );\n\n    return;\n  }\n\n  // Otherwise assume we are on an EC2 instance\n\n  // get a token\n  request(\n    `${AWS_EC2_URI}/latest/api/token`,\n    { method: 'PUT', json: false, headers: { 'X-aws-ec2-metadata-token-ttl-seconds': 30 } },\n    (err, token) => {\n      if (err) return callback(err);\n\n      // get role name\n      request(\n        `${AWS_EC2_URI}/${AWS_EC2_PATH}`,\n        { json: false, headers: { 'X-aws-ec2-metadata-token': token } },\n        (err, roleName) => {\n          if (err) return callback(err);\n\n          // get temp credentials\n          request(\n            `${AWS_EC2_URI}/${AWS_EC2_PATH}/${roleName}`,\n            { headers: { 'X-aws-ec2-metadata-token': token } },\n            (err, creds) => {\n              if (err) return callback(err);\n              done(creds);\n            }\n          );\n        }\n      );\n    }\n  );\n}\n\nfunction deriveRegion(host: string) {\n  const parts = host.split('.');\n  if (parts.length === 1 || parts[1] === 'amazonaws') {\n    return 'us-east-1';\n  }\n\n  return parts[1];\n}\n\ninterface RequestOptions {\n  json?: boolean;\n  method?: string;\n  timeout?: number;\n  headers?: http.OutgoingHttpHeaders;\n}\n\nfunction request(uri: string, callback: Callback): void;\nfunction request(uri: string, options: RequestOptions, callback: Callback): void;\nfunction request(uri: string, _options: RequestOptions | Callback, _callback?: Callback) {\n  let options = _options as RequestOptions;\n  if ('function' === typeof _options) {\n    options = {};\n  }\n\n  let callback: Callback = _options as Callback;\n  if (_callback) {\n    callback = _callback;\n  }\n\n  options = Object.assign(\n    {\n      method: 'GET',\n      timeout: 10000,\n      json: true\n    },\n    url.parse(uri),\n    options\n  );\n\n  const req = http.request(options, res => {\n    res.setEncoding('utf8');\n\n    let data = '';\n    res.on('data', d => (data += d));\n    res.on('end', () => {\n      if (options.json === false) {\n        callback(undefined, data);\n        return;\n      }\n\n      try {\n        const parsed = JSON.parse(data);\n        callback(undefined, parsed);\n      } catch (err) {\n        callback(new MongoDriverError(`Invalid JSON response: \"${data}\"`));\n      }\n    });\n  });\n\n  req.on('error', err => callback(err));\n  req.end();\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}